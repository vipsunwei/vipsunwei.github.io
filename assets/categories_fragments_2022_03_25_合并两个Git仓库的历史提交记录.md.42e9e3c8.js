import{_ as t}from"./chunks/ArticleMetadata.dd4bf5dc.js";import{_ as c,c as r,g as i,w as d,b as e,f as y,a as C,i as h,o as l,e as A,j as B}from"./app.960cb299.js";const g="/assets/202203252252923.7f17f3fa.png",m="/assets/202203252252926.df88a888.png",D="/assets/202203252252929.dbbfced6.png",u="/assets/202203252252931.4b1de048.png",T=JSON.parse('{"title":"合并两个Git仓库的历史提交记录","description":"","frontmatter":{"title":"合并两个Git仓库的历史提交记录","author":"查尔斯","date":"2022/03/25 21:30","categories":["杂碎逆袭史"],"tags":["Git"]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[{"level":3,"title":"将前端项目提交到后端库","slug":"将前端项目提交到后端库","link":"#将前端项目提交到后端库","children":[]},{"level":3,"title":"不影响提交记录，合并仓库","slug":"不影响提交记录-合并仓库","link":"#不影响提交记录-合并仓库","children":[]}]},{"level":2,"title":"后记","slug":"后记","link":"#后记","children":[]}],"relativePath":"categories/fragments/2022/03/25/合并两个Git仓库的历史提交记录.md","lastUpdated":1677831742000}'),b={name:"categories/fragments/2022/03/25/合并两个Git仓库的历史提交记录.md"},_=e("h1",{id:"合并两个git仓库的历史提交记录",tabindex:"-1"},[y("合并两个Git仓库的历史提交记录 "),e("a",{class:"header-anchor",href:"#合并两个git仓库的历史提交记录","aria-hidden":"true"},"#")],-1),F=C(`<h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-hidden="true">#</a></h2><p><strong>C：</strong> 最近在下班的时间一直在维护一个基于 EL-Admin 这个开源后台管理系统的衍生开源项目。EL-Admin 这个项目是采用前后端分离架构开发的，所以在开源平台上是分为了两个项目库，一个前端的，一个后端的。</p><p>这本无可厚非，分成两个项目库，在开发时还是挺友好的，公司内部基本也是这个模式，但对于一个开源项目来说，分散为两个库还是有一些不利的方面。</p><ol><li>在管理 issue 上不太方便，项目作者要兼顾查看两个项目，而且有些小伙伴在提出 issue 时并不会管你这是前端库还是后端库，提就完事了。在这方面，EL-Admin 项目的作者应该也发现了这个问题，所以直接干脆的关闭了前端库的 issue 功能，集中在后端库一起管理。</li><li>在 star 方面会造成分流，前段时间看了看微博，在不知什么时候，竟然加入了一个明星超话，意外就看到置顶帖里标注了一点禁止创建其他小号超话，现在想想这不是一个意思吗？</li><li>...</li></ol><p>本来笔者最开始也是按原项目形式创建了两个 Git 仓库，但最近更换设备开发时单独要拉两次仓库，觉得很麻烦，思索了下突然意识到上述问题，干脆趁着这热乎劲儿，以后端仓库为主，把两个仓库合并一下。</p><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-hidden="true">#</a></h2><h3 id="将前端项目提交到后端库" tabindex="-1">将前端项目提交到后端库 <a class="header-anchor" href="#将前端项目提交到后端库" aria-hidden="true">#</a></h3><p>这是笔者首先想到的方法，即将前端项目拉下来，然后将前端项目的源码放到后端库里，提交一下。很简单粗暴，但是这种方法会造成之前前端项目历史提交记录的丢失。</p><h3 id="不影响提交记录-合并仓库" tabindex="-1">不影响提交记录，合并仓库 <a class="header-anchor" href="#不影响提交记录-合并仓库" aria-hidden="true">#</a></h3><p>笔者当然不希望将前端项目的历史提交记录丢失了，所以最终采用了下方的方案，完整步骤如下：</p><div class="tip custom-block"><p class="custom-block-title">笔者说</p><p>提示说明一下，后端仓库名叫：eladminx，前端仓库名叫：eladminx-web</p></div><ol><li><p>克隆后端项目仓库到本地（笔者没有在 git bash 中操作，而是在 cmd 中进行的）</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://gitee.com/Charles7c/eladminx.git</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">eladminx</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">clone</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://gitee.com/Charles7c/eladminx.git</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">eladminx</span></span>
<span class="line"></span></code></pre></div><p><img src="`+g+`" alt="202203252252923"></p></li><li><p>将前端仓库作为后端仓库的远程仓库，起别名为 frontend（这个随便起）</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">remote</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">frontend</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://gitee.com/Charles7c/eladminx-web.git</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">remote</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">add</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-f</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">frontend</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://gitee.com/Charles7c/eladminx-web.git</span></span>
<span class="line"></span></code></pre></div><p><img src="`+m+`" alt="202203252252926"></p></li><li><p>将前端仓库的 master 分支（自己选择哪个分支）合并到后端仓库</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">merge</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--strategy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ours</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--no-commit</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">frontend/master</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">merge</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--strategy</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ours</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--no-commit</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">frontend/master</span></span>
<span class="line"></span></code></pre></div><p><img src="`+D+`" alt="202203252252929"></p><p>想法很美，但是报错了：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">fatal: refusing to merge unrelated histories</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#abb2bf;">fatal: refusing to merge unrelated histories</span></span>
<span class="line"><span style="color:#abb2bf;"></span></span></code></pre></div><p>这是因为后端仓库的本地分支历史记录和前端仓库的历史记录不匹配，人家 Git 怀疑你是不是合并错了，但咱们知道就是要合并，写个声明 “表明出事儿与人家无关”就可以了。</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">merge</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--strategy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ours</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--allow-unrelated-histories</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--no-commit</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">frontend/master</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">merge</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--strategy</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ours</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--allow-unrelated-histories</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--no-commit</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">frontend/master</span></span>
<span class="line"></span></code></pre></div><p><img src="`+u+`" alt="202203252252931"></p></li><li><p>将前端仓库的 master 分支内容放到在后端仓库内刚建好的 eladminx-web 文件夹中</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">eladminx-web</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">read-tree</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--prefix=eladminx-web/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">frontend/master</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mkdir </span><span style="color:#98C379;">eladminx-web</span></span>
<span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">read-tree</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--prefix=eladminx-web/</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-u</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">frontend/master</span></span>
<span class="line"></span></code></pre></div></li><li><p>提交刚才的修改（毕竟你刚才又合并又创建文件夹的，肯定要提交修改啊）</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">commit</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">迁移前端项目仓库，与后端项目仓库合并</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">commit</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-m</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;迁移前端项目仓库，与后端项目仓库合并&quot;</span></span>
<span class="line"></span></code></pre></div></li><li><p>最后将本地的修改强制推送到远程仓库即可</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">push</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--force</span></span>
<span class="line"></span></code></pre><pre class="shiki one-dark-pro vp-code-light" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">git </span><span style="color:#98C379;">push</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--force</span></span>
<span class="line"></span></code></pre></div></li></ol><p>到此为止，笔者这两个项目的 master 分支就合并完了，如果你想合并其他分支，例如：dev，那就首先把后端仓库的分支切换到 dev，然后将上述中的 master 这个分支名换为 dev 就可以了。</p><h2 id="后记" tabindex="-1">后记 <a class="header-anchor" href="#后记" aria-hidden="true">#</a></h2><p><strong>C：</strong> 关于这个合并，你以哪个仓库为主都可以。最后合并的提交记录是以历史提交时间进行降序排列的。</p>`,15);function f(s,k,v,x,E,w){const p=t,o=h("ClientOnly");return l(),r("div",null,[_,i(o,null,{default:d(()=>{var a,n;return[(((a=s.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=s.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(l(),A(p,{key:0,article:s.$frontmatter},null,8,["article"])):B("",!0)]}),_:1}),F])}const V=c(b,[["render",f]]);export{T as __pageData,V as default};
